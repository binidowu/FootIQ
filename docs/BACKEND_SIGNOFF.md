# FootIQ Backend Sign-Off Checklist

Use this checklist to declare backend "done" before UI work starts.

Status rule:
- All `Required` items must be checked.
- `Conditional` items must be checked if the related feature is enabled.

---

## 1) Contract Compliance (Required)

- [x] `POST /agent/query` always returns HTTP 200 with contract envelope.
- [x] Response always includes required fields:
  - `schema_version`, `trace_id`, `status`, `session`, `output`, `metadata`, `warnings`, `suggestions`, `error`
- [x] `warnings` is always an array.
- [x] `suggestions` is always an array and max length is 3.
- [x] `error` is `null` on `status:"ok"` and object on `status:"error"`.
- [x] `schema_version` behavior matches contract:
  - higher unsupported -> `SCHEMA_MISMATCH`
  - lower supported -> best-effort + `SCHEMA_VERSION_UPLEVEL` warning

Evidence:
- `python_agent/tests/test_main_contract.py`
- `python_agent/main.py`
- `docs/API_CONTRACT.md`

---

## 2) End-to-End Behavior (Required)

Run through Node gateway (`/query`) and verify result envelope + expected code/path.

- [x] Surface replay query returns `status:"ok"` with `data_depth:"L1"`.
- [x] Deep replay query returns `status:"ok"` with `data_depth:"L2"` (or safe fallback answer + warnings when metric unavailable).
- [x] Cold-start pronoun query returns `INSUFFICIENT_CONTEXT`.
- [x] Unknown player returns `PLAYER_NOT_FOUND`.
- [x] Ambiguous player returns `AMBIGUOUS_ENTITY` with `error.options`.
- [x] L1 constraint (`max_depth:"L1"`) excludes deep tools and does not invoke lineup-only path.
- [x] Missing `OPENAI_API_KEY` returns `UPSTREAM_DOWN`.

Evidence:
- `python_agent/tests/test_football_agent.py`
- manual curl logs

---

## 3) Replay Mode Guarantees (Required)

- [x] `data_mode:"replay"` never performs upstream network calls.
- [x] Replay responses include `DATA_MODE_REPLAY` warning (including cache-hit responses).
- [x] Fixture fallback works for canonicalized names (example: `"Erling Haaland"` -> `search_entity__haaland.json`).
- [x] Core replay fixtures exist for demo entities used in tests.

Evidence:
- `python_agent/tests/test_data_tools.py`
- `python_agent/data_tools.py`
- `python_agent/tests/fixtures/sportapi/`

---

## 4) Quant + Analytics Integrity (Required)

- [x] Per-90 logic uses sum/sum and 90-minute threshold (`INSUFFICIENT_MINUTES` warning path).
- [x] Derived metrics behavior matches `STATS_CONFIG.md`.
- [x] Z-score guardrails return raw per-90 + `BASELINE_MISSING` warnings.
- [x] Plot naming follows contract and file sanitization is enforced.
- [x] Plot failures return `ARTIFACT_WRITE_FAILED` warning path.

Evidence:
- `python_agent/tests/test_quant_tools.py`
- `python_agent/quant_tools.py`
- `docs/STATS_CONFIG.md`

---

## 5) Artifact Pipeline (Conditional)

Only required if chart generation is enabled.

- [x] Plot file is created under `node_gateway/public/plots/`.
- [x] Plot URL is returned as `/static/plots/<filename>`.
- [x] Node serves plot file with HTTP 200 (`image/png`).
- [x] Cleanup job does not delete fresh files during demo window.

Evidence:
- `node_gateway/server.js`
- manual curl/file check

---

## 6) Runtime Config + Dependency Health (Required)

- [x] `OPENAI_API_KEY` is loaded in runtime environment.
- [x] Python deps install cleanly from `python_agent/requirements.txt`.
- [x] Node deps install cleanly from `node_gateway/package.json`.
- [x] Health checks are green:
  - `GET /health` on Python
  - `GET /health` on Node

---

## 7) Observability + Traceability (Required)

- [x] `trace_id` is generated by Node and propagated end-to-end.
- [x] Errors include contract code and message.
- [x] Tool invocation metadata is returned (`metadata.tools_invoked`).
- [x] Warning codes are structured and actionable.

---

## 8) Test Gates (Required)

- [x] Unit/integration suite passes in `python_agent`:
  - `pytest -q`
- [x] No failing tests in:
  - `tests/test_data_tools.py`
  - `tests/test_quant_tools.py`
  - `tests/test_football_agent.py`
  - `tests/test_main_contract.py`

Latest run:
- Date: 2026-02-11
- Result: 75 passed, 14 warnings

---

## 9) API Freeze Before UI (Required)

- [x] `docs/API_CONTRACT.md` frozen for UI integration window.
- [x] `docs/INTENT_ROUTING.md` reflects current runtime behavior.
- [x] `docs/STATS_CONFIG.md` aligned with code.
- [x] Any known deviations documented with owner + follow-up date.

Known deviations:
- None outstanding for backend sign-off gate. Continue monitoring during UI integration.

---

## 10) Final Decision Gate

- [x] Backend sign-off approved.
- [x] UI build approved to start.

Approvers:
- Engineering: Ayomide Adebayo
- Product/Demo Owner: Ayomide Adebayo
- Date: 2026-02-11
